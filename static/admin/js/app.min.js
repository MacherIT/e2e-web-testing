"use strict";angular.module("AdminApp",["ngRoute"]).controller("mainController",["$scope","$location","$rootScope","auth",function(a,u,o,e){o.isLoggedIn=e.isLoggedIn(),a.rutas=[],o.$on("$routeChangeSuccess",function(){a.rutas=[];var o=u.path().split("/");if(""!=o[1]){for(var e="",r="",t=0;t<o.length;t++)if(""!=o[t]){var n;e+=r+o[t],n=o[t]=o[t].replace(/-/g," "),a.rutas.push({nombre:n,link:e,active:!1}),r="/"}a.rutas[a.rutas.length-1].active=!0}}),o.deleteProp=function(o,e){delete o[e]}}]),angular.module("AdminApp").config(["$routeProvider","$locationProvider",function(o,e){e.hashPrefix(""),o.when("/usuarios",{templateUrl:"views/usuario/index.html",controller:"usuario.index"}).when("/usuarios/registrar",{templateUrl:"views/usuario/new.html",controller:"usuario.new"}).when("/usuarios/iniciar-sesion",{templateUrl:"views/usuario/login.html",controller:"usuario.login"}).when("/usuarios/cerrar-sesion",{templateUrl:"views/home/index.html",resolve:{secureAccess:["auth","$window",function(o,e){o.isLoggedIn()||(e.location.href="#/",e.location.reload())}]},controller:"usuario.logout"}).when("/usuarios/perfil",{templateUrl:"views/usuario/perfil.html",resolve:{secureAccess:["auth","$window",function(o,e){o.isLoggedIn()||(e.location.href="#/",e.location.reload())}]},controller:"usuario.show"}).when("/usuario/:id",{templateUrl:"views/user/show.html",controller:"user.show"}).otherwise({templateUrl:"views/home/index.html",redirectTo:"/"})}]),angular.module("AdminApp").factory("auth",["$http","$window",function(e,r){var t=function(o){r.localStorage["mtgroup-token"]=o},n=function(){return r.localStorage["mtgroup-token"]},o={headers:{Authorization:"Bearer "+n()}},a=function(){var o,e=n();return!!e&&(o=e.split(".")[1],o=r.atob(o),(o=JSON.parse(o)).exp>Date.now()/1e3)};return{currentUser:function(){if(a()){var o=n().split(".")[1];return o=r.atob(o),{email:(o=JSON.parse(o)).email,name:o.name}}},saveToken:t,getToken:n,secureKey:o,isLoggedIn:a,register:function(o){return e.post("/api/usuarios",o).then(function(o){t(o.data.token)})},updateUser:function(o){return e.put("/api/usuarios/perfil",o,{headers:{Authorization:"Bearer "+n()}}).then(function(o){})},login:function(o){return e.post("/api/usuarios/login",o).then(function(o){return t(o.data.token),o},function(o){return o})},logout:function(){r.localStorage.removeItem("mtgroup-token")}}}]),angular.module("AdminApp").factory("dataProvider",["$http","auth",function(e,r){return{getPerfil:function(){return e.get("/api/usuarios/perfil",r.secureKey)},getUsuario:function(o){return e.get("/api/usuarios/"+o,r.secureKey)},getUsuarios:function(){return e.get("/api/usuarios",r.secureKey)}}}]),angular.module("AdminApp").factory("imageUploader",["$http","auth",function(t,n){return{uploadFiles:function(o){for(var e=new FormData,r=0;r<o.length;r++)e.append("imagenes",o[r]);return t.post("/upload",e,{headers:{transformRequest:angular.identity,"Content-Type":void 0,Authorization:"Bearer "+n.getToken()}}).then(function(o){return o})}}}]),angular.module("UsuarioModule",[]),angular.module("UsuarioModule").controller("usuario.login",["$scope","$window","auth",function(e,r,o){o.isLoggedIn()?(r.location.href="#/user",r.location.reload()):(e.email="",e.password="",e.failLogin=!1,e.sendForm=function(){o.login({email:e.email,password:e.password}).then(function(o){401===o.status?e.failLogin=!0:(r.location.href="#/user",r.location.reload())})})}]),angular.module("UsuarioModule").controller("usuario.logout",["$scope","$window","auth",function(o,e,r){r.logout(),e.location.href="#/",e.location.reload()}]),angular.module("UsuarioModule").controller("usuario.new",["$scope","$window","auth","dataProvider","$http",function(r,t,n,o,a){n.isLoggedIn()?(t.location.href="#/user",t.location.reload()):(r.nuevoUsuario={email:"",nombre:"",apellido:""},r.registrarUsuario=function(){r.f=document.getElementById("usuario-avatar").files[0],r.notMatch=!1,r.dupped=!1,r.passwordCheck===r.nuevoUsuario.password?n.register(r.nuevoUsuario).then(function(o){if(n.isLoggedIn()){if(r.f){var e=new FormData;e.append("imagenes",r.f),console.log(e),a.post("/upload",e,{headers:{transformRequest:angular.identity,"Content-Type":void 0,Authorization:"Bearer "+n.getToken()}}).then(function(o){200===o.status&&(r.nuevoUsuario.avatar=o.data[0].uri,n.updateUser(r.nuevoUsuario).then(function(o){t.location.href="#/usuarios/perfil",t.location.reload()}).catch(function(o){console.log(o)}))})}}else t.location.href="#/usuarios/perfil",t.location.reload()}).catch(function(o){console.log(o),o.data.error.code&&(r.dupped=11e3==o.data.error.code)}):r.notMatch=!0})}]),angular.module("UsuarioModule").controller("usuario.show",["$scope","dataProvider",function(e,o){e.usuario={},o.getPerfil().then(function(o){console.log(o),e.usuario=o.data}).catch(function(o){console.log(o)})}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0YXRpYy9hZG1pbi9qcy9hcHAubWluLmpzIiwibWFpbi5qcyIsInJvdXRlcy9pbmRleC5qcyIsInNlcnZpY2VzL2F1dGguanMiLCJzZXJ2aWNlcy9kYXRhLXByb3ZpZGVyLmpzIiwic2VydmljZXMvaW1hZ2UtdXBsb2FkZXIuanMiLCJjb250cm9sbGVycy91c3VhcmlvL2luZGV4LmpzIiwiY29udHJvbGxlcnMvdXN1YXJpby9fbG9naW4uanMiLCJjb250cm9sbGVycy91c3VhcmlvL19sb2dvdXQuanMiLCJjb250cm9sbGVycy91c3VhcmlvL19uZXcuanMiLCJjb250cm9sbGVycy91c3VhcmlvL19zaG93LmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGxvY2F0aW9uIiwiJHJvb3RTY29wZSIsImF1dGgiLCJpc0xvZ2dlZEluIiwicnV0YXMiLCIkb24iLCJwYXRoIiwic3BsaXQiLCJiYXIiLCJpIiwibGVuZ3RoIiwibm9tYnJlIiwicmVwbGFjZSIsInB1c2giLCJsaW5rIiwiYWN0aXZlIiwiZGVsZXRlUHJvcCIsIm9iaiIsInByb3AiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwiaGFzaFByZWZpeCIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsInJlc29sdmUiLCJzZWN1cmVBY2Nlc3MiLCIkd2luZG93IiwibG9jYXRpb24iLCJocmVmIiwicmVsb2FkIiwib3RoZXJ3aXNlIiwicmVkaXJlY3RUbyIsImZhY3RvcnkiLCIkaHR0cCIsInNhdmVUb2tlbiIsInRva2VuIiwibG9jYWxTdG9yYWdlIiwiZ2V0VG9rZW4iLCJzZWN1cmVLZXkiLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsInBheWxvYWQiLCJhdG9iIiwiSlNPTiIsInBhcnNlIiwiZXhwIiwiRGF0ZSIsIm5vdyIsImN1cnJlbnRVc2VyIiwiZW1haWwiLCJuYW1lIiwicmVnaXN0ZXIiLCJ1c2VyIiwicG9zdCIsInRoZW4iLCJyZXNwb25zZSIsImRhdGEiLCJ1cGRhdGVVc2VyIiwicHV0IiwibG9naW4iLCJlcnIiLCJsb2dvdXQiLCJyZW1vdmVJdGVtIiwiZ2V0UGVyZmlsIiwiZ2V0IiwiZ2V0VXN1YXJpbyIsImlkIiwiZ2V0VXN1YXJpb3MiLCJ1cGxvYWRGaWxlcyIsImltYWdlQXJyYXkiLCJGb3JtRGF0YSIsImFwcGVuZCIsInRyYW5zZm9ybVJlcXVlc3QiLCJpZGVudGl0eSIsIkNvbnRlbnQtVHlwZSIsInVuZGVmaW5lZCIsInBhc3N3b3JkIiwiZmFpbExvZ2luIiwic2VuZEZvcm0iLCJzdGF0dXMiLCJkYXRhUHJvdmlkZXIiLCJudWV2b1VzdWFyaW8iLCJhcGVsbGlkbyIsInJlZ2lzdHJhclVzdWFyaW8iLCJmIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImZpbGVzIiwibm90TWF0Y2giLCJkdXBwZWQiLCJwYXNzd29yZENoZWNrIiwiY29uc29sZSIsImxvZyIsImF2YXRhciIsInVyaSIsImNhdGNoIiwiZXJyb3IiLCJjb2RlIiwidXN1YXJpbyJdLCJtYXBwaW5ncyI6IkFBQUEsYUNBQUEsUUFDR0MsT0FBTyxZQUFhLFlBQ3BCQyxXQUFXLGtCQUFBLFNBQUEsWUFBQSxhQUFBLE9BQWtCLFNBQUNDLEVBQVFDLEVBQVdDLEVBQVlDLEdBQzVERCxFQUFXRSxXQUFhRCxFQUFLQyxhQUU3QkosRUFBT0ssU0FFUEgsRUFBV0ksSUFBSSxzQkFBdUIsV0FDcENOLEVBQU9LLFNBRVAsSUFBSUEsRUFBUUosRUFBVU0sT0FBT0MsTUFBTSxLQUVuQyxHQUFnQixJQUFaSCxFQUFNLEdBQVUsQ0FLbEIsSUFKQSxJQUFJRSxFQUFPLEdBRVBFLEVBQU0sR0FFREMsRUFBSSxFQUFHQSxFQUFJTCxFQUFNTSxPQUFRRCxJQUNoQyxHQUFnQixJQUFaTCxFQUFNSyxHQUFVLENBQ2xCLElBQUlFLEVBQ0pMLEdBQVFFLEVBQU1KLEVBQU1LLEdBQ3BCRSxFQUFTUCxFQUFNSyxHQUFLTCxFQUFNSyxHQUFHRyxRQUFRLEtBQU0sS0FD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bkcsRUFBTzJGLE9BQWdDLE1BQXZCN0IsRUFBSUosS0FBS3dDLE1BQU1DLFFBR3JDbkcsRUFBTzBGLFVBQVcsT0M5RDVCN0YsUUFDR0MsT0FBTyxpQkFDUEMsV0FBVyxnQkFBQSxTQUFBLGVBQWdCLFNBQUNDLEVBQVFrRixHQUNuQ2xGLEVBQU9vRyxXQUVQbEIsRUFDR2pCLFlBQ0FULEtBQUssU0FBQUMsR0FDSm9DLFFBQVFDLElBQUlyQyxHQUNaekQsRUFBT29HLFFBQVUzQyxFQUFTQyxPQUUzQnVDLE1BQU0sU0FBQW5DLEdBQ0wrQixRQUFRQyxJQUFJaEMiLCJmaWxlIjoic3RhdGljL2FkbWluL2pzL2FwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuYW5ndWxhci5tb2R1bGUoXCJBZG1pbkFwcFwiLCBbXCJuZ1JvdXRlXCJdKS5jb250cm9sbGVyKFwibWFpbkNvbnRyb2xsZXJcIiwgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCAkcm9vdFNjb3BlLCBhdXRoKSB7XG4gICRyb290U2NvcGUuaXNMb2dnZWRJbiA9IGF1dGguaXNMb2dnZWRJbigpO1xuXG4gICRzY29wZS5ydXRhcyA9IFtdO1xuXG4gICRyb290U2NvcGUuJG9uKFwiJHJvdXRlQ2hhbmdlU3VjY2Vzc1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgJHNjb3BlLnJ1dGFzID0gW107XG5cbiAgICB2YXIgcnV0YXMgPSAkbG9jYXRpb24ucGF0aCgpLnNwbGl0KFwiL1wiKTtcblxuICAgIGlmIChydXRhc1sxXSAhPSBcIlwiKSB7XG4gICAgICB2YXIgcGF0aCA9IFwiXCI7XG5cbiAgICAgIHZhciBiYXIgPSBcIlwiO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJ1dGFzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChydXRhc1tpXSAhPSBcIlwiKSB7XG4gICAgICAgICAgdmFyIG5vbWJyZSA9IFwiXCI7XG4gICAgICAgICAgcGF0aCArPSBiYXIgKyBydXRhc1tpXTtcbiAgICAgICAgICBub21icmUgPSBydXRhc1tpXSA9IHJ1dGFzW2ldLnJlcGxhY2UoLy0vZywgXCIgXCIpO1xuICAgICAgICAgICRzY29wZS5ydXRhcy5wdXNoKHsgbm9tYnJlOiBub21icmUsIGxpbms6IHBhdGgsIGFjdGl2ZTogZmFsc2UgfSk7XG4gICAgICAgICAgYmFyID0gXCIvXCI7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgJHNjb3BlLnJ1dGFzWyRzY29wZS5ydXRhcy5sZW5ndGggLSAxXS5hY3RpdmUgPSB0cnVlO1xuICAgIH1cbiAgfSk7XG5cbiAgJHJvb3RTY29wZS5kZWxldGVQcm9wID0gZnVuY3Rpb24gKG9iaiwgcHJvcCkge1xuICAgIGRlbGV0ZSBvYmpbcHJvcF07XG4gIH07XG59KTtcblwidXNlIHN0cmljdFwiO1xuXG5hbmd1bGFyLm1vZHVsZShcIkFkbWluQXBwXCIpLmNvbmZpZyhmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XG4gICRsb2NhdGlvblByb3ZpZGVyLmhhc2hQcmVmaXgoXCJcIik7XG5cbiAgJHJvdXRlUHJvdmlkZXJcbiAgLy8gVVNVQVJJT1xuXG4gIC53aGVuKFwiL3VzdWFyaW9zXCIsIHtcbiAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy91c3VhcmlvL2luZGV4Lmh0bWxcIixcbiAgICBjb250cm9sbGVyOiBcInVzdWFyaW8uaW5kZXhcIlxuICB9KS53aGVuKFwiL3VzdWFyaW9zL3JlZ2lzdHJhclwiLCB7XG4gICAgdGVtcGxhdGVVcmw6IFwidmlld3MvdXN1YXJpby9uZXcuaHRtbFwiLFxuICAgIGNvbnRyb2xsZXI6IFwidXN1YXJpby5uZXdcIlxuICB9KS53aGVuKFwiL3VzdWFyaW9zL2luaWNpYXItc2VzaW9uXCIsIHtcbiAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy91c3VhcmlvL2xvZ2luLmh0bWxcIixcbiAgICBjb250cm9sbGVyOiBcInVzdWFyaW8ubG9naW5cIlxuICB9KS53aGVuKFwiL3VzdWFyaW9zL2NlcnJhci1zZXNpb25cIiwge1xuICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL2hvbWUvaW5kZXguaHRtbFwiLFxuICAgIHJlc29sdmU6IHtcbiAgICAgIHNlY3VyZUFjY2VzczogZnVuY3Rpb24gc2VjdXJlQWNjZXNzKGF1dGgsICR3aW5kb3cpIHtcbiAgICAgICAgaWYgKCFhdXRoLmlzTG9nZ2VkSW4oKSkge1xuICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiIy9cIjtcbiAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBjb250cm9sbGVyOiBcInVzdWFyaW8ubG9nb3V0XCJcbiAgfSkud2hlbihcIi91c3Vhcmlvcy9wZXJmaWxcIiwge1xuICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL3VzdWFyaW8vcGVyZmlsLmh0bWxcIixcbiAgICByZXNvbHZlOiB7XG4gICAgICBzZWN1cmVBY2Nlc3M6IGZ1bmN0aW9uIHNlY3VyZUFjY2VzcyhhdXRoLCAkd2luZG93KSB7XG4gICAgICAgIGlmICghYXV0aC5pc0xvZ2dlZEluKCkpIHtcbiAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIiMvXCI7XG4gICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgY29udHJvbGxlcjogXCJ1c3VhcmlvLnNob3dcIlxuICB9KS53aGVuKFwiL3VzdWFyaW8vOmlkXCIsIHtcbiAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy91c2VyL3Nob3cuaHRtbFwiLFxuICAgIGNvbnRyb2xsZXI6IFwidXNlci5zaG93XCJcbiAgfSlcbiAgLy9PVEhFUldJU0VcblxuICAub3RoZXJ3aXNlKHtcbiAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9ob21lL2luZGV4Lmh0bWxcIixcbiAgICByZWRpcmVjdFRvOiBcIi9cIlxuICB9KTtcblxuICAvLyB1c2UgdGhlIEhUTUw1IEhpc3RvcnkgQVBJXG4gIC8vICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcbn0pO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbmFuZ3VsYXIubW9kdWxlKFwiQWRtaW5BcHBcIikuZmFjdG9yeShcImF1dGhcIiwgZnVuY3Rpb24gKCRodHRwLCAkd2luZG93KSB7XG4gIHZhciBzYXZlVG9rZW4gPSBmdW5jdGlvbiBzYXZlVG9rZW4odG9rZW4pIHtcbiAgICAkd2luZG93LmxvY2FsU3RvcmFnZVtcIm10Z3JvdXAtdG9rZW5cIl0gPSB0b2tlbjtcbiAgfTtcblxuICB2YXIgZ2V0VG9rZW4gPSBmdW5jdGlvbiBnZXRUb2tlbigpIHtcbiAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2VbXCJtdGdyb3VwLXRva2VuXCJdO1xuICB9O1xuXG4gIHZhciBzZWN1cmVLZXkgPSB7XG4gICAgaGVhZGVyczoge1xuICAgICAgQXV0aG9yaXphdGlvbjogXCJCZWFyZXIgXCIgKyBnZXRUb2tlbigpXG4gICAgfVxuICB9O1xuXG4gIHZhciBpc0xvZ2dlZEluID0gZnVuY3Rpb24gaXNMb2dnZWRJbigpIHtcbiAgICB2YXIgdG9rZW4gPSBnZXRUb2tlbigpO1xuICAgIHZhciBwYXlsb2FkO1xuXG4gICAgaWYgKHRva2VuKSB7XG4gICAgICBwYXlsb2FkID0gdG9rZW4uc3BsaXQoXCIuXCIpWzFdO1xuICAgICAgcGF5bG9hZCA9ICR3aW5kb3cuYXRvYihwYXlsb2FkKTtcbiAgICAgIHBheWxvYWQgPSBKU09OLnBhcnNlKHBheWxvYWQpO1xuXG4gICAgICByZXR1cm4gcGF5bG9hZC5leHAgPiBEYXRlLm5vdygpIC8gMTAwMDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcblxuICB2YXIgY3VycmVudFVzZXIgPSBmdW5jdGlvbiBjdXJyZW50VXNlcigpIHtcbiAgICBpZiAoaXNMb2dnZWRJbigpKSB7XG4gICAgICB2YXIgdG9rZW4gPSBnZXRUb2tlbigpO1xuICAgICAgdmFyIHBheWxvYWQgPSB0b2tlbi5zcGxpdChcIi5cIilbMV07XG4gICAgICBwYXlsb2FkID0gJHdpbmRvdy5hdG9iKHBheWxvYWQpO1xuICAgICAgcGF5bG9hZCA9IEpTT04ucGFyc2UocGF5bG9hZCk7XG4gICAgICByZXR1cm4geyBlbWFpbDogcGF5bG9hZC5lbWFpbCwgbmFtZTogcGF5bG9hZC5uYW1lIH07XG4gICAgfVxuICB9O1xuXG4gIHZhciByZWdpc3RlciA9IGZ1bmN0aW9uIHJlZ2lzdGVyKHVzZXIpIHtcbiAgICByZXR1cm4gJGh0dHAucG9zdChcIi9hcGkvdXN1YXJpb3NcIiwgdXNlcikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIHNhdmVUb2tlbihyZXNwb25zZS5kYXRhLnRva2VuKTtcbiAgICB9KTtcbiAgfTtcblxuICB2YXIgdXBkYXRlVXNlciA9IGZ1bmN0aW9uIHVwZGF0ZVVzZXIodXNlcikge1xuICAgIHJldHVybiAkaHR0cC5wdXQoXCIvYXBpL3VzdWFyaW9zL3BlcmZpbFwiLCB1c2VyLCB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIEF1dGhvcml6YXRpb246IFwiQmVhcmVyIFwiICsgZ2V0VG9rZW4oKVxuICAgICAgfVxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgfSk7XG4gIH07XG5cbiAgdmFyIGxvZ2luID0gZnVuY3Rpb24gbG9naW4odXNlcikge1xuICAgIHJldHVybiAkaHR0cC5wb3N0KFwiL2FwaS91c3Vhcmlvcy9sb2dpblwiLCB1c2VyKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgc2F2ZVRva2VuKHJlc3BvbnNlLmRhdGEudG9rZW4pO1xuICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgIHJldHVybiBlcnI7XG4gICAgfSk7XG4gIH07XG5cbiAgdmFyIGxvZ291dCA9IGZ1bmN0aW9uIGxvZ291dCgpIHtcbiAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwibXRncm91cC10b2tlblwiKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGN1cnJlbnRVc2VyOiBjdXJyZW50VXNlcixcbiAgICBzYXZlVG9rZW46IHNhdmVUb2tlbixcbiAgICBnZXRUb2tlbjogZ2V0VG9rZW4sXG4gICAgc2VjdXJlS2V5OiBzZWN1cmVLZXksXG4gICAgaXNMb2dnZWRJbjogaXNMb2dnZWRJbixcbiAgICByZWdpc3RlcjogcmVnaXN0ZXIsXG4gICAgdXBkYXRlVXNlcjogdXBkYXRlVXNlcixcbiAgICBsb2dpbjogbG9naW4sXG4gICAgbG9nb3V0OiBsb2dvdXRcbiAgfTtcbn0pO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbmFuZ3VsYXIubW9kdWxlKFwiQWRtaW5BcHBcIikuZmFjdG9yeShcImRhdGFQcm92aWRlclwiLCBmdW5jdGlvbiAoJGh0dHAsIGF1dGgpIHtcbiAgcmV0dXJuIHtcbiAgICAvL1VTRVJcbiAgICBnZXRQZXJmaWw6IGZ1bmN0aW9uIGdldFBlcmZpbCgpIHtcbiAgICAgIHJldHVybiAkaHR0cC5nZXQoXCIvYXBpL3VzdWFyaW9zL3BlcmZpbFwiLCBhdXRoLnNlY3VyZUtleSk7XG4gICAgfSxcbiAgICBnZXRVc3VhcmlvOiBmdW5jdGlvbiBnZXRVc3VhcmlvKGlkKSB7XG4gICAgICByZXR1cm4gJGh0dHAuZ2V0KFwiL2FwaS91c3Vhcmlvcy9cIiArIGlkLCBhdXRoLnNlY3VyZUtleSk7XG4gICAgfSxcbiAgICBnZXRVc3VhcmlvczogZnVuY3Rpb24gZ2V0VXN1YXJpb3MoKSB7XG4gICAgICByZXR1cm4gJGh0dHAuZ2V0KFwiL2FwaS91c3Vhcmlvc1wiLCBhdXRoLnNlY3VyZUtleSk7XG4gICAgfVxuICB9O1xufSk7XG5cInVzZSBzdHJpY3RcIjtcblxuYW5ndWxhci5tb2R1bGUoXCJBZG1pbkFwcFwiKS5mYWN0b3J5KFwiaW1hZ2VVcGxvYWRlclwiLCBmdW5jdGlvbiAoJGh0dHAsIGF1dGgpIHtcbiAgcmV0dXJuIHtcbiAgICB1cGxvYWRGaWxlczogZnVuY3Rpb24gdXBsb2FkRmlsZXMoaW1hZ2VBcnJheSkge1xuICAgICAgLy9cbiAgICAgIHZhciBkYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGltYWdlQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZGF0YS5hcHBlbmQoXCJpbWFnZW5lc1wiLCBpbWFnZUFycmF5W2ldKTtcbiAgICAgIH1cbiAgICAgIC8vXG4gICAgICByZXR1cm4gJGh0dHAucG9zdChcIi91cGxvYWRcIiwgZGF0YSwge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgdHJhbnNmb3JtUmVxdWVzdDogYW5ndWxhci5pZGVudGl0eSxcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiB1bmRlZmluZWQsXG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogXCJCZWFyZXIgXCIgKyBhdXRoLmdldFRva2VuKClcbiAgICAgICAgfVxuICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xufSk7XG5cInVzZSBzdHJpY3RcIjtcblxuYW5ndWxhci5tb2R1bGUoXCJVc3VhcmlvTW9kdWxlXCIsIFtdKTtcblwidXNlIHN0cmljdFwiO1xuXG5hbmd1bGFyLm1vZHVsZShcIlVzdWFyaW9Nb2R1bGVcIikuY29udHJvbGxlcihcInVzdWFyaW8ubG9naW5cIiwgZnVuY3Rpb24gKCRzY29wZSwgJHdpbmRvdywgYXV0aCkge1xuICBpZiAoIWF1dGguaXNMb2dnZWRJbigpKSB7XG4gICAgJHNjb3BlLmVtYWlsID0gXCJcIjtcbiAgICAkc2NvcGUucGFzc3dvcmQgPSBcIlwiO1xuICAgICRzY29wZS5mYWlsTG9naW4gPSBmYWxzZTtcblxuICAgICRzY29wZS5zZW5kRm9ybSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGF1dGgubG9naW4oeyBlbWFpbDogJHNjb3BlLmVtYWlsLCBwYXNzd29yZDogJHNjb3BlLnBhc3N3b3JkIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICAgICRzY29wZS5mYWlsTG9naW4gPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiIy91c2VyXCI7XG4gICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIiMvdXNlclwiO1xuICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gIH1cbn0pO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbmFuZ3VsYXIubW9kdWxlKFwiVXN1YXJpb01vZHVsZVwiKS5jb250cm9sbGVyKFwidXN1YXJpby5sb2dvdXRcIiwgZnVuY3Rpb24gKCRzY29wZSwgJHdpbmRvdywgYXV0aCkge1xuICBhdXRoLmxvZ291dCgpO1xuICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIiMvXCI7XG4gICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG59KTtcblwidXNlIHN0cmljdFwiO1xuXG5hbmd1bGFyLm1vZHVsZShcIlVzdWFyaW9Nb2R1bGVcIikuY29udHJvbGxlcihcInVzdWFyaW8ubmV3XCIsIGZ1bmN0aW9uICgkc2NvcGUsICR3aW5kb3csIGF1dGgsIGRhdGFQcm92aWRlciwgJGh0dHApIHtcbiAgaWYgKCFhdXRoLmlzTG9nZ2VkSW4oKSkge1xuICAgICRzY29wZS5udWV2b1VzdWFyaW8gPSB7XG4gICAgICBlbWFpbDogXCJcIixcbiAgICAgIG5vbWJyZTogXCJcIixcbiAgICAgIGFwZWxsaWRvOiBcIlwiXG4gICAgfTtcblxuICAgICRzY29wZS5yZWdpc3RyYXJVc3VhcmlvID0gZnVuY3Rpb24gKCkge1xuICAgICAgJHNjb3BlLmYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInVzdWFyaW8tYXZhdGFyXCIpLmZpbGVzWzBdO1xuXG4gICAgICAkc2NvcGUubm90TWF0Y2ggPSBmYWxzZTtcbiAgICAgICRzY29wZS5kdXBwZWQgPSBmYWxzZTtcblxuICAgICAgaWYgKCRzY29wZS5wYXNzd29yZENoZWNrID09PSAkc2NvcGUubnVldm9Vc3VhcmlvLnBhc3N3b3JkKSB7XG4gICAgICAgIGF1dGgucmVnaXN0ZXIoJHNjb3BlLm51ZXZvVXN1YXJpbykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICBpZiAoYXV0aC5pc0xvZ2dlZEluKCkpIHtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuZikge1xuICAgICAgICAgICAgICB2YXIgZGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgICBkYXRhLmFwcGVuZChcImltYWdlbmVzXCIsICRzY29wZS5mKTtcblxuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcblxuICAgICAgICAgICAgICAkaHR0cC5wb3N0KFwiL3VwbG9hZFwiLCBkYXRhLCB7XG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtUmVxdWVzdDogYW5ndWxhci5pZGVudGl0eSxcbiAgICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IFwiQmVhcmVyIFwiICsgYXV0aC5nZXRUb2tlbigpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgJHNjb3BlLm51ZXZvVXN1YXJpby5hdmF0YXIgPSByZXNwb25zZS5kYXRhWzBdLnVyaTtcblxuICAgICAgICAgICAgICAgICAgYXV0aC51cGRhdGVVc2VyKCRzY29wZS5udWV2b1VzdWFyaW8pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiIy91c3Vhcmlvcy9wZXJmaWxcIjtcbiAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiIy91c3Vhcmlvcy9wZXJmaWxcIjtcbiAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICBpZiAoZXJyLmRhdGEuZXJyb3IuY29kZSkgJHNjb3BlLmR1cHBlZCA9IGVyci5kYXRhLmVycm9yLmNvZGUgPT0gMTEwMDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLm5vdE1hdGNoID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9O1xuICB9IGVsc2Uge1xuICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiIy91c2VyXCI7XG4gICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgfVxufSk7XG5cInVzZSBzdHJpY3RcIjtcblxuYW5ndWxhci5tb2R1bGUoXCJVc3VhcmlvTW9kdWxlXCIpLmNvbnRyb2xsZXIoXCJ1c3VhcmlvLnNob3dcIiwgZnVuY3Rpb24gKCRzY29wZSwgZGF0YVByb3ZpZGVyKSB7XG4gICRzY29wZS51c3VhcmlvID0ge307XG5cbiAgZGF0YVByb3ZpZGVyLmdldFBlcmZpbCgpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICRzY29wZS51c3VhcmlvID0gcmVzcG9uc2UuZGF0YTtcbiAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgIGNvbnNvbGUubG9nKGVycik7XG4gIH0pO1xufSk7IiwiYW5ndWxhclxuICAubW9kdWxlKFwiQWRtaW5BcHBcIiwgW1wibmdSb3V0ZVwiXSlcbiAgLmNvbnRyb2xsZXIoXCJtYWluQ29udHJvbGxlclwiLCAoJHNjb3BlLCAkbG9jYXRpb24sICRyb290U2NvcGUsIGF1dGgpID0+IHtcbiAgICAkcm9vdFNjb3BlLmlzTG9nZ2VkSW4gPSBhdXRoLmlzTG9nZ2VkSW4oKTtcblxuICAgICRzY29wZS5ydXRhcyA9IFtdO1xuXG4gICAgJHJvb3RTY29wZS4kb24oXCIkcm91dGVDaGFuZ2VTdWNjZXNzXCIsICgpID0+IHtcbiAgICAgICRzY29wZS5ydXRhcyA9IFtdO1xuXG4gICAgICBsZXQgcnV0YXMgPSAkbG9jYXRpb24ucGF0aCgpLnNwbGl0KFwiL1wiKTtcblxuICAgICAgaWYgKHJ1dGFzWzFdICE9IFwiXCIpIHtcbiAgICAgICAgbGV0IHBhdGggPSBcIlwiO1xuXG4gICAgICAgIGxldCBiYXIgPSBcIlwiO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcnV0YXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAocnV0YXNbaV0gIT0gXCJcIikge1xuICAgICAgICAgICAgbGV0IG5vbWJyZSA9IFwiXCI7XG4gICAgICAgICAgICBwYXRoICs9IGJhciArIHJ1dGFzW2ldO1xuICAgICAgICAgICAgbm9tYnJlID0gcnV0YXNbaV0gPSBydXRhc1tpXS5yZXBsYWNlKC8tL2csIFwiIFwiKTtcbiAgICAgICAgICAgICRzY29wZS5ydXRhcy5wdXNoKHsgbm9tYnJlOiBub21icmUsIGxpbms6IHBhdGgsIGFjdGl2ZTogZmFsc2UgfSk7XG4gICAgICAgICAgICBiYXIgPSBcIi9cIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAkc2NvcGUucnV0YXNbJHNjb3BlLnJ1dGFzLmxlbmd0aCAtIDFdLmFjdGl2ZSA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAkcm9vdFNjb3BlLmRlbGV0ZVByb3AgPSAob2JqLCBwcm9wKSA9PiB7XG4gICAgICBkZWxldGUgb2JqW3Byb3BdO1xuICAgIH07XG4gIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoXCJBZG1pbkFwcFwiKS5jb25maWcoKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikgPT4ge1xuICAkbG9jYXRpb25Qcm92aWRlci5oYXNoUHJlZml4KFwiXCIpO1xuXG4gICRyb3V0ZVByb3ZpZGVyXG4gICAgLy8gVVNVQVJJT1xuXG4gICAgLndoZW4oXCIvdXN1YXJpb3NcIiwge1xuICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvdXN1YXJpby9pbmRleC5odG1sXCIsXG4gICAgICBjb250cm9sbGVyOiBcInVzdWFyaW8uaW5kZXhcIlxuICAgIH0pXG4gICAgLndoZW4oXCIvdXN1YXJpb3MvcmVnaXN0cmFyXCIsIHtcbiAgICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL3VzdWFyaW8vbmV3Lmh0bWxcIixcbiAgICAgIGNvbnRyb2xsZXI6IFwidXN1YXJpby5uZXdcIlxuICAgIH0pXG4gICAgLndoZW4oXCIvdXN1YXJpb3MvaW5pY2lhci1zZXNpb25cIiwge1xuICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvdXN1YXJpby9sb2dpbi5odG1sXCIsXG4gICAgICBjb250cm9sbGVyOiBcInVzdWFyaW8ubG9naW5cIlxuICAgIH0pXG4gICAgLndoZW4oXCIvdXN1YXJpb3MvY2VycmFyLXNlc2lvblwiLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9ob21lL2luZGV4Lmh0bWxcIixcbiAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgc2VjdXJlQWNjZXNzOiAoYXV0aCwgJHdpbmRvdykgPT4ge1xuICAgICAgICAgIGlmICghYXV0aC5pc0xvZ2dlZEluKCkpIHtcbiAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiIy9cIjtcbiAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgY29udHJvbGxlcjogXCJ1c3VhcmlvLmxvZ291dFwiXG4gICAgfSlcbiAgICAud2hlbihcIi91c3Vhcmlvcy9wZXJmaWxcIiwge1xuICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvdXN1YXJpby9wZXJmaWwuaHRtbFwiLFxuICAgICAgcmVzb2x2ZToge1xuICAgICAgICBzZWN1cmVBY2Nlc3M6IChhdXRoLCAkd2luZG93KSA9PiB7XG4gICAgICAgICAgaWYgKCFhdXRoLmlzTG9nZ2VkSW4oKSkge1xuICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIjL1wiO1xuICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjb250cm9sbGVyOiBcInVzdWFyaW8uc2hvd1wiXG4gICAgfSlcbiAgICAud2hlbihcIi91c3VhcmlvLzppZFwiLCB7XG4gICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy91c2VyL3Nob3cuaHRtbFwiLFxuICAgICAgY29udHJvbGxlcjogXCJ1c2VyLnNob3dcIlxuICAgIH0pXG4gICAgLy9PVEhFUldJU0VcblxuICAgIC5vdGhlcndpc2Uoe1xuICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvaG9tZS9pbmRleC5odG1sXCIsXG4gICAgICByZWRpcmVjdFRvOiBcIi9cIlxuICAgIH0pO1xuXG4gIC8vIHVzZSB0aGUgSFRNTDUgSGlzdG9yeSBBUElcbiAgLy8gJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xufSk7XG4iLCJhbmd1bGFyLm1vZHVsZShcIkFkbWluQXBwXCIpLmZhY3RvcnkoXCJhdXRoXCIsICgkaHR0cCwgJHdpbmRvdykgPT4ge1xuICB2YXIgc2F2ZVRva2VuID0gdG9rZW4gPT4ge1xuICAgICR3aW5kb3cubG9jYWxTdG9yYWdlW1wibXRncm91cC10b2tlblwiXSA9IHRva2VuO1xuICB9O1xuXG4gIHZhciBnZXRUb2tlbiA9ICgpID0+ICR3aW5kb3cubG9jYWxTdG9yYWdlW1wibXRncm91cC10b2tlblwiXTtcblxuICB2YXIgc2VjdXJlS2V5ID0ge1xuICAgIGhlYWRlcnM6IHtcbiAgICAgIEF1dGhvcml6YXRpb246IFwiQmVhcmVyIFwiICsgZ2V0VG9rZW4oKVxuICAgIH1cbiAgfTtcblxuICB2YXIgaXNMb2dnZWRJbiA9ICgpID0+IHtcbiAgICB2YXIgdG9rZW4gPSBnZXRUb2tlbigpO1xuICAgIHZhciBwYXlsb2FkO1xuXG4gICAgaWYgKHRva2VuKSB7XG4gICAgICBwYXlsb2FkID0gdG9rZW4uc3BsaXQoXCIuXCIpWzFdO1xuICAgICAgcGF5bG9hZCA9ICR3aW5kb3cuYXRvYihwYXlsb2FkKTtcbiAgICAgIHBheWxvYWQgPSBKU09OLnBhcnNlKHBheWxvYWQpO1xuXG4gICAgICByZXR1cm4gcGF5bG9hZC5leHAgPiBEYXRlLm5vdygpIC8gMTAwMDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcblxuICB2YXIgY3VycmVudFVzZXIgPSAoKSA9PiB7XG4gICAgaWYgKGlzTG9nZ2VkSW4oKSkge1xuICAgICAgdmFyIHRva2VuID0gZ2V0VG9rZW4oKTtcbiAgICAgIHZhciBwYXlsb2FkID0gdG9rZW4uc3BsaXQoXCIuXCIpWzFdO1xuICAgICAgcGF5bG9hZCA9ICR3aW5kb3cuYXRvYihwYXlsb2FkKTtcbiAgICAgIHBheWxvYWQgPSBKU09OLnBhcnNlKHBheWxvYWQpO1xuICAgICAgcmV0dXJuIHsgZW1haWw6IHBheWxvYWQuZW1haWwsIG5hbWU6IHBheWxvYWQubmFtZSB9O1xuICAgIH1cbiAgfTtcblxuICB2YXIgcmVnaXN0ZXIgPSB1c2VyID0+XG4gICAgJGh0dHAucG9zdChcIi9hcGkvdXN1YXJpb3NcIiwgdXNlcikudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICBzYXZlVG9rZW4ocmVzcG9uc2UuZGF0YS50b2tlbik7XG4gICAgfSk7XG5cbiAgdmFyIHVwZGF0ZVVzZXIgPSB1c2VyID0+XG4gICAgJGh0dHBcbiAgICAgIC5wdXQoXCIvYXBpL3VzdWFyaW9zL3BlcmZpbFwiLCB1c2VyLCB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBcIkJlYXJlciBcIiArIGdldFRva2VuKClcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgLy8gY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgfSk7XG5cbiAgdmFyIGxvZ2luID0gdXNlciA9PlxuICAgICRodHRwLnBvc3QoXCIvYXBpL3VzdWFyaW9zL2xvZ2luXCIsIHVzZXIpLnRoZW4oXG4gICAgICByZXNwb25zZSA9PiB7XG4gICAgICAgIHNhdmVUb2tlbihyZXNwb25zZS5kYXRhLnRva2VuKTtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgfSxcbiAgICAgIGVyciA9PiB7XG4gICAgICAgIHJldHVybiBlcnI7XG4gICAgICB9XG4gICAgKTtcblxuICB2YXIgbG9nb3V0ID0gKCkgPT4ge1xuICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJtdGdyb3VwLXRva2VuXCIpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgY3VycmVudFVzZXI6IGN1cnJlbnRVc2VyLFxuICAgIHNhdmVUb2tlbjogc2F2ZVRva2VuLFxuICAgIGdldFRva2VuOiBnZXRUb2tlbixcbiAgICBzZWN1cmVLZXk6IHNlY3VyZUtleSxcbiAgICBpc0xvZ2dlZEluOiBpc0xvZ2dlZEluLFxuICAgIHJlZ2lzdGVyOiByZWdpc3RlcixcbiAgICB1cGRhdGVVc2VyOiB1cGRhdGVVc2VyLFxuICAgIGxvZ2luOiBsb2dpbixcbiAgICBsb2dvdXQ6IGxvZ291dFxuICB9O1xufSk7XG4iLCJhbmd1bGFyLm1vZHVsZShcIkFkbWluQXBwXCIpLmZhY3RvcnkoXCJkYXRhUHJvdmlkZXJcIiwgKCRodHRwLCBhdXRoKSA9PiB7XG4gIHJldHVybiB7XG4gICAgLy9VU0VSXG4gICAgZ2V0UGVyZmlsOiAoKSA9PiAkaHR0cC5nZXQoXCIvYXBpL3VzdWFyaW9zL3BlcmZpbFwiLCBhdXRoLnNlY3VyZUtleSksXG4gICAgZ2V0VXN1YXJpbzogaWQgPT4gJGh0dHAuZ2V0KFwiL2FwaS91c3Vhcmlvcy9cIiArIGlkLCBhdXRoLnNlY3VyZUtleSksXG4gICAgZ2V0VXN1YXJpb3M6ICgpID0+ICRodHRwLmdldChcIi9hcGkvdXN1YXJpb3NcIiwgYXV0aC5zZWN1cmVLZXkpXG4gIH07XG59KTtcbiIsImFuZ3VsYXIubW9kdWxlKFwiQWRtaW5BcHBcIikuZmFjdG9yeShcImltYWdlVXBsb2FkZXJcIiwgKCRodHRwLCBhdXRoKSA9PiB7XG4gIHJldHVybiB7XG4gICAgdXBsb2FkRmlsZXM6IGltYWdlQXJyYXkgPT4ge1xuICAgICAgLy9cbiAgICAgIGxldCBkYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZGF0YS5hcHBlbmQoXCJpbWFnZW5lc1wiLCBpbWFnZUFycmF5W2ldKTtcbiAgICAgIH1cbiAgICAgIC8vXG4gICAgICByZXR1cm4gJGh0dHBcbiAgICAgICAgLnBvc3QoXCIvdXBsb2FkXCIsIGRhdGEsIHtcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICB0cmFuc2Zvcm1SZXF1ZXN0OiBhbmd1bGFyLmlkZW50aXR5LFxuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogXCJCZWFyZXIgXCIgKyBhdXRoLmdldFRva2VuKClcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfTtcbn0pO1xuIiwiYW5ndWxhci5tb2R1bGUoXCJVc3VhcmlvTW9kdWxlXCIsIFtdKVxuIiwiYW5ndWxhclxuICAubW9kdWxlKFwiVXN1YXJpb01vZHVsZVwiKVxuICAuY29udHJvbGxlcihcInVzdWFyaW8ubG9naW5cIiwgKCRzY29wZSwgJHdpbmRvdywgYXV0aCkgPT4ge1xuICAgIGlmICghYXV0aC5pc0xvZ2dlZEluKCkpIHtcbiAgICAgICRzY29wZS5lbWFpbCA9IFwiXCI7XG4gICAgICAkc2NvcGUucGFzc3dvcmQgPSBcIlwiO1xuICAgICAgJHNjb3BlLmZhaWxMb2dpbiA9IGZhbHNlO1xuXG4gICAgICAkc2NvcGUuc2VuZEZvcm0gPSAoKSA9PiB7XG4gICAgICAgIGF1dGhcbiAgICAgICAgICAubG9naW4oeyBlbWFpbDogJHNjb3BlLmVtYWlsLCBwYXNzd29yZDogJHNjb3BlLnBhc3N3b3JkIH0pXG4gICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICAgICRzY29wZS5mYWlsTG9naW4gPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIjL3VzZXJcIjtcbiAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiIy91c2VyXCI7XG4gICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgIH1cbiAgfSk7XG4iLCJhbmd1bGFyXG4gIC5tb2R1bGUoXCJVc3VhcmlvTW9kdWxlXCIpXG4gIC5jb250cm9sbGVyKFwidXN1YXJpby5sb2dvdXRcIiwgKCRzY29wZSwgJHdpbmRvdywgYXV0aCkgPT4ge1xuICAgIGF1dGgubG9nb3V0KCk7XG4gICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIjL1wiO1xuICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gIH0pO1xuIiwiYW5ndWxhclxuICAubW9kdWxlKFwiVXN1YXJpb01vZHVsZVwiKVxuICAuY29udHJvbGxlcihcInVzdWFyaW8ubmV3XCIsICgkc2NvcGUsICR3aW5kb3csIGF1dGgsIGRhdGFQcm92aWRlciwgJGh0dHApID0+IHtcbiAgICBpZiAoIWF1dGguaXNMb2dnZWRJbigpKSB7XG4gICAgICAkc2NvcGUubnVldm9Vc3VhcmlvID0ge1xuICAgICAgICBlbWFpbDogXCJcIixcbiAgICAgICAgbm9tYnJlOiBcIlwiLFxuICAgICAgICBhcGVsbGlkbzogXCJcIlxuICAgICAgfTtcblxuICAgICAgJHNjb3BlLnJlZ2lzdHJhclVzdWFyaW8gPSAoKSA9PiB7XG4gICAgICAgICRzY29wZS5mID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ1c3VhcmlvLWF2YXRhclwiKS5maWxlc1swXTtcblxuICAgICAgICAkc2NvcGUubm90TWF0Y2ggPSBmYWxzZTtcbiAgICAgICAgJHNjb3BlLmR1cHBlZCA9IGZhbHNlO1xuXG4gICAgICAgIGlmICgkc2NvcGUucGFzc3dvcmRDaGVjayA9PT0gJHNjb3BlLm51ZXZvVXN1YXJpby5wYXNzd29yZCkge1xuICAgICAgICAgIGF1dGhcbiAgICAgICAgICAgIC5yZWdpc3Rlcigkc2NvcGUubnVldm9Vc3VhcmlvKVxuICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICBpZiAoYXV0aC5pc0xvZ2dlZEluKCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmYpIHtcbiAgICAgICAgICAgICAgICAgIGxldCBkYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgICAgICAgICAgICBkYXRhLmFwcGVuZChcImltYWdlbmVzXCIsICRzY29wZS5mKTtcblxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICRodHRwXG4gICAgICAgICAgICAgICAgICAgIC5wb3N0KFwiL3VwbG9hZFwiLCBkYXRhLCB7XG4gICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtUmVxdWVzdDogYW5ndWxhci5pZGVudGl0eSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IFwiQmVhcmVyIFwiICsgYXV0aC5nZXRUb2tlbigpXG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubnVldm9Vc3VhcmlvLmF2YXRhciA9IHJlc3BvbnNlLmRhdGFbMF0udXJpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC51cGRhdGVVc2VyKCRzY29wZS5udWV2b1VzdWFyaW8pXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIiMvdXN1YXJpb3MvcGVyZmlsXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIjL3VzdWFyaW9zL3BlcmZpbFwiO1xuICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgaWYgKGVyci5kYXRhLmVycm9yLmNvZGUpXG4gICAgICAgICAgICAgICAgJHNjb3BlLmR1cHBlZCA9IGVyci5kYXRhLmVycm9yLmNvZGUgPT0gMTEwMDAgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkc2NvcGUubm90TWF0Y2ggPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIiMvdXNlclwiO1xuICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICB9XG4gIH0pO1xuIiwiYW5ndWxhclxuICAubW9kdWxlKFwiVXN1YXJpb01vZHVsZVwiKVxuICAuY29udHJvbGxlcihcInVzdWFyaW8uc2hvd1wiLCAoJHNjb3BlLCBkYXRhUHJvdmlkZXIpID0+IHtcbiAgICAkc2NvcGUudXN1YXJpbyA9IHt9O1xuXG4gICAgZGF0YVByb3ZpZGVyXG4gICAgICAuZ2V0UGVyZmlsKClcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAkc2NvcGUudXN1YXJpbyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICB9KTtcbiAgfSk7XG4iXX0=
